<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise Detox Presents, Detox Jeapardy</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Set Inter font family -->
    <style>
        html, body {
            font-family: 'Inter', sans-serif;
            background-color: #060a2b; /* Dark blue background */
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* No scrolling */
        }
        
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            /* NEW: Hidden by default, shown after intro */
            opacity: 0; 
            transition: opacity 1s ease-in;
        }

        /* --- INTRO ANIMATION STYLES (NEW) --- */
        #intro-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, #020411, #1a0b16);
            transition: opacity 1.5s ease-in-out;
        }
        
        .animate-sky {
            animation: sky-change 4s ease-out forwards;
        }

        .sun-graphic {
            width: 150px;
            height: 150px;
            background: linear-gradient(to bottom, #fbbf24, #f59e0b);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(251, 191, 36, 0.6);
            position: relative;
            z-index: 10;
            animation: sunrise 4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .ocean {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(to top, #06226e, #1e3a8a);
            z-index: 20;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }

        .intro-content {
            position: relative;
            z-index: 30;
            text-align: center;
            margin-top: -80px; /* Overlap sun slightly */
            opacity: 0;
            animation: fade-in-text 2s ease-out forwards;
            animation-delay: 3s; /* Wait for sun */
        }

        @keyframes sunrise {
            0% { transform: translateY(200%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes sky-change {
            0% { background: linear-gradient(to bottom, #020411, #000000); }
            100% { background: linear-gradient(to bottom, #1e1b4b, #4c1d95); }
        }
        @keyframes fade-in-text {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        /* --- END INTRO ANIMATION STYLES --- */


        /* Custom styles for the Jeopardy board */
        .jeopardy-board {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 4px; /* Reduced gap */
            flex-grow: 1; /* Board fills remaining space */
            min-height: 0; /* Allows board to shrink */
        }
        .category-cell {
            background-color: #06226e; /* Jeopardy blue */
            color: white;
            font-weight: bold;
            text-align: center;
            /* RESPONSIVE: Scalable vertical padding and font size */
            padding: clamp(4px, 1.2vh, 8px) 4px;
            font-size: clamp(0.65rem, 2.4vw, 0.875rem);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
            min-height: 0;
        }
        .question-cell {
            background-color: #06226e; /* Jeopardy blue */
            color: #ffcc00; /* Jeopardy yellow */
            /* RESPONSIVE: Scalable font size and padding */
            font-size: clamp(0.9rem, 4vw, 1.3rem);
            padding: clamp(4px, 2vh, 8px);
            font-weight: bold;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
            min-height: 0;
        }
        .question-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }
        .question-cell.answered {
            background-color: #373b5a;
            color: #6b7280;
            cursor: not-allowed;
            pointer-events: none;
        }
        .question-cell.answered::after {
            content: 'ANSWERED';
            /* RESPONSIVE: Scaled font size */
            font-size: clamp(0.6rem, 2vw, 0.875rem);
            font-weight: normal;
        }
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            /* RESPONSIVE: Scalable padding and reduced min-height */
            padding: clamp(12px, 3vw, 20px);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            min-height: 300px; /* Reduced min-height */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .modal-question {
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(1rem, 4vw, 1.25rem);
            font-weight: 500;
            color: #1f2937;
            text-align: center;
            margin: auto;
            padding: 16px;
        }
        .modal-answer {
            display: none; /* Hidden until revealed */
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            font-weight: 600;
            color: #10b981; /* Green for answer */
            text-align: center;
            margin: 16px 0;
        }
        
        /* SMALLER SCOREBOARD STYLES */
        .team-scoreboard {
            background-color: #ffffff;
            /* RESPONSIVE: Scalable padding */
            padding: clamp(6px, 2vw, 8px);
            border-radius: 8px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .team-scoreboard.active {
            /* 'var(--team-color)' will be set by JS */
            border-color: var(--team-color, #3b82f6); 
            box-shadow: 0 0 15px var(--team-color, #3b82f6);
        }
        .team-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        .team-name-input {
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            font-weight: 700;
            color: #1f2937;
            border: none;
            outline: none;
            width: 100%;
            padding: 2px 0;
        }
        .team-name-input:focus {
            border-bottom: 2px solid #3b82f6;
        }
        .team-color-picker {
            /* RESPONSIVE: Scalable width and height */
            width: clamp(20px, 5vw, 24px);
            height: clamp(20px, 5vw, 24px);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 0;
        }
        /* NEW: Styles for the editable score input */
        .team-score {
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(1.4rem, 5vw, 1.75rem);
            font-weight: 800;
            color: #06226e;
            /* Input specific styles */
            background: none; 
            border: none;
            border-bottom: 3px solid transparent; 
            text-align: center;
            padding: 0;
            width: 100%;
            outline: none;
            transition: border-color 0.2s;
            /* Remove default number input spin buttons */
            -moz-appearance: textfield; 
        }
        .team-score::-webkit-inner-spin-button, 
        .team-score::-webkit-outer-spin-button { 
            -webkit-appearance: none;
            margin: 0;
        }
        /* Focus styles for the editable score */
        #team-1-score:focus {
            border-color: #3b82f6; /* Team 1 blue */
        }
        #team-2-score:focus {
            border-color: #ef4444; /* Team 2 red */
        }
        
        .team-score-label {
            font-size: 0.875rem; /* 14px */
            font-weight: 700;
            color: #4b5563;
        }
        
        /* Daily Double Modal Styles */
        #daily-double-modal .modal-content {
            min-height: 250px;
            justify-content: center;
            background-color: #060a2b;
            border: 4px solid #ffcc00;
        }
        #dd-wager-input {
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(1rem, 4vw, 1.25rem);
            font-weight: bold;
            text-align: center;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #ccc;
        }

        /* Timer Styles */
        #timer-container {
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
        }
        #timer-display {
            /* RESPONSIVE: Scalable font size */
            font-size: clamp(1.75rem, 7vw, 2.25rem);
            font-weight: 800;
            color: #06226e;
            width: 50px;
            text-align: center;
        }
        #timer-toggle-btn {
            background-color: #06226e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #timer-toggle-btn:hover {
            background-color: #0e3aa6;
        }
        #timer-toggle-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* --- Winner Modal Styles --- */
        #winner-modal .modal-content {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            transform: scale(1);
            animation: popin 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border: 8px solid #060a2b;
            box-shadow: 0 0 50px rgba(255, 204, 0, 0.8);
            text-align: center;
            padding: 40px;
        }

        .winner-text {
            font-size: clamp(1.5rem, 8vw, 3rem);
            font-weight: 900;
            color: #060a2b;
            line-height: 1.1;
            margin-bottom: 20px;
            text-shadow: 4px 4px 0px rgba(255, 255, 255, 0.7);
        }

        /* --- Change Team Modal Styles --- */
        #change-team-modal .modal-content {
            background-color: #4f46e5; /* Indigo */
            color: white;
            text-align: center;
            padding: 30px;
        }
        .change-team-title {
            font-size: clamp(2rem, 6vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 10px;
        }

    </style>
</head>
<body class="p-2 md:p-4">

    <!-- NEW: INTRO OVERLAY -->
    <div id="intro-overlay" class="animate-sky">
        <div class="sun-graphic"></div>
        <div class="ocean"></div>
        
        <div class="intro-content">
            <h1 class="text-5xl md:text-7xl font-extrabold text-white tracking-wide drop-shadow-lg mb-2">
                <span class="text-yellow-400">SUNRISE</span> DETOX
            </h1>
            <p class="text-xl text-blue-200 tracking-[0.5em] uppercase font-semibold mb-8">Presents, Detox Jeapardy</p>
            
            <button id="start-game-btn" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-blue-900 transition-all duration-200 bg-yellow-400 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 hover:bg-yellow-300 hover:scale-110 shadow-[0_0_20px_rgba(253,224,71,0.5)]">
                START GAME
            </button>
            <div class="mt-4 text-blue-300 text-xs opacity-70">Click Start to Enable Audio</div>
        </div>
    </div>
    <!-- END INTRO OVERLAY -->

    <div id="game-container" class="container mx-auto max-w-6xl">
        <!-- Header -->
        <div class="relative flex justify-center items-center mb-3">
             <h1 class="text-2xl md:text-3xl font-extrabold text-center text-white">Sunrise Detox Presents, Detox Jeapardy</h1>
             <button id="reset-game" class="absolute right-0 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-lg transition-colors text-sm">
                Reset
            </button>
        </div>
       
        <!-- Scoreboard -->
        <div class="grid grid-cols-2 gap-2 mb-3">
            <!-- Team 1 Scoreboard -->
            <div id="team-1-board" class="team-scoreboard active" style="--team-color: #3b82f6;">
                <div class="team-header">
                    <input type="color" id="team-1-color" class="team-color-picker" value="#3b82f6">
                    <input type="text" id="team-1-name" class="team-name-input" value="Team 1">
                </div>
                <h2 class="team-score-label">Score:</h2>
                <!-- Score is now an editable input field -->
                <div class="flex items-center justify-between">
                    <input type="number" id="team-1-score" class="team-score" value="0" min="0">
                </div>
            </div>

            <!-- Team 2 Scoreboard -->
            <div id="team-2-board" class="team-scoreboard" style="--team-color: #ef4444;">
                <div class="team-header">
                    <input type="color" id="team-2-color" class="team-color-picker" value="#ef4444">
                    <input type="text" id="team-2-name" class="team-name-input" value="Team 2">
                </div>
                <h2 class="team-score-label">Score:</h2>
                <!-- Score is now an editable input field -->
                <div class="flex items-center justify-between">
                    <input type="number" id="team-2-score" class="team-score" value="0" min="0">
                </div>
            </div>
        </div>

        <!-- Jeopardy Board -->
        <div id="jeopardy-board" class="jeopardy-board">
            <!-- Categories and questions will be injected by JavaScript -->
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="modal">
        <div class="modal-content">
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span id="modal-category" class="text-lg font-semibold text-blue-700">Category</span>
                    <span id="modal-points" class="text-xl font-bold text-yellow-600">$000</span>
                </div>
                
                <div id="modal-notification" class="hidden text-center text-lg font-bold text-red-600 my-2"></div>

                <div id="modal-question-text" class="modal-question">
                    Question text will appear here...
                </div>
                <div id="modal-answer-text" class="modal-answer">
                    Answer text will appear here...
                </div>
            </div>

            <!-- Button & Timer Container -->
            <div>
                <div id="timer-container">
                    <div id="timer-display">37</div> <!-- Timer starts at 37 -->
                    <button id="timer-toggle-btn" title="Play/Pause Timer">
                        <!-- Icon will be set by JS -->
                    </button>
                </div>

                <div id="button-container" class="mt-4 flex flex-col gap-3">
                    <!-- RESPONSIVE: Stacks buttons on small screens (sm:grid-cols-2) -->
                    <div id="scoring-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <!-- RESPONSIVE: Smaller text on mobile (text-base) -->
                        <button id="correct-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors text-base md:text-lg">
                            I Got It Right!
                        </button>
                        <button id="incorrect-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors text-base md:text-lg">
                            I Got It Wrong
                        </button>
                    </div>
                    <!-- NEW: Next button, hidden by default -->
                    <!-- RESPONSIVE: Smaller text on mobile (text-base) -->
                    <button id="next-btn" class="hidden w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors text-base md:text-lg">
                        Next
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Double Modal -->
    <div id="daily-double-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-4xl md:text-5xl font-extrabold text-center text-yellow-400 mb-6" style="text-shadow: 2px 2px #000;">DAILY DOUBLE</h2>
            <div class="text-center mb-4">
                <label for="dd-wager-input" class="text-white text-xl md:text-2xl font-medium" id="dd-wager-label">Enter Wager:</label>
                <input type="number" id="dd-wager-input" class="mt-2" min="5">
            </div>
            <!-- RESPONSIVE: Smaller text on mobile (text-base) -->
            <button id="submit-wager-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-lg transition-colors text-base md:text-lg">
                Submit Wager
            </button>
        </div>
    </div>
    
    <!-- Winner Modal -->
    <div id="winner-modal" class="modal">
        <div class="modal-content">
            <div id="confetti-container" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
            <div class="relative z-10">
                <p class="text-center text-2xl font-bold mb-4">Game Over! The winner is:</p>
                <h2 id="winner-name" class="winner-text"></h2>
                <h1 class="winner-text text-5xl md:text-7xl">WINNER WINNER CHICKEN DINNER</h1>
                <button id="close-winner-modal-btn" class="mt-8 bg-black hover:bg-gray-800 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Start New Game
                </button>
            </div>
        </div>
    </div>

    <!-- Change Team Modal -->
    <div id="change-team-modal" class="modal">
        <div class="modal-content !bg-indigo-600 !text-white !justify-center">
            <h1 class="change-team-title">Change Team</h1>
            <p class="text-xl mb-6">Team <span id="next-team-name" class="font-bold"></span>, it's your turn!</p>
            <button id="confirm-change-team-btn" class="w-full bg-white hover:bg-gray-100 text-indigo-700 font-bold py-3 px-4 rounded-lg transition-colors text-lg">
                Continue
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ---------------------------------
            // --- 1. GAME DATA ---
            // ---------------------------------
            const gameData = {
                "Mental Health Basics": {
                    100: { q: "This is a common mood disorder characterized by persistent sadness, loss of interest, and feelings of worthlessness.", a: "What is depression?" },
                    200: { q: "This condition involves excessive, persistent worry and fear about everyday situations.", a: "What is an anxiety disorder?" },
                    300: { q: "A disorder associated with episodes of mood swings ranging from depressive lows to manic highs.", a: "What is bipolar disorder?" },
                    400: { q: "The practice of being fully present and engaged in the current moment without judgment.", a: "What is mindfulness?" },
                    500: { q: "A negative and unfair belief associated with a particular circumstance, quality, or person, often preventing people from seeking help.", a: "What is stigma?" }
                },
                "Detox & Withdrawal": {
                    100: { q: "The medical process of safely helping the body rid itself of a substance.", a: "What is detoxification (or detox)?" },
                    200: { q: "The physical and mental symptoms that occur after stopping or reducing intake of a substance.", a: "What is withdrawal?" },
                    300: { q: "A state in which the body adapts to a substance, requiring more of it to achieve the same effect.", a: "What is tolerance?" },
                    400: { q: "A set of symptoms that can continue for weeks, months, or even years after stopping substance use.", a: "What is Post-Acute Withdrawal Syndrome (PAWS)?" },
                    500: { q: "The term for when a person needs a substance to function 'normally' and experiences withdrawal without it.", a: "What is physical dependence?" }
                },
                "Recovery Principles": {
                    100: { q: "This phrase encourages focusing on the present 24 hours rather than worrying about the distant future.", a: "What is 'One Day at aTime'?" },
                    200: { q: "A person in recovery who guides a newer member through the program.", a: "What is a sponsor?" },
                    300: { q: "This acronym is a reminder to check if you are feeling 'Hungry, Angry, Lonely, or Tired'â€”common relapse triggers.", a: "What is H.A.L.T.?" },
                    400: { q: "A return to substance use after a period of abstinence.", a: "What is a relapse?" },
                    500: { q: "This concept, often from the Serenity Prayer, involves accepting what you cannot change and changing what you can.", a: "What is acceptance?" }
                },
                "The 12 Steps": {
                    100: { q: "Step 1 involves admitting this over alcohol or another substance.", a: "What is powerlessness?" },
                    200: { q: "Step 2 involves coming to believe in this, 'as we understood Him.'", a: "What is a Power greater than ourselves?" },
                    300: { q: "Step 3 is about making a decision to turn our will and lives over to this.", a: "What is the care of God (or a Higher Power)?" },
                    400: { q: "Step 4 involves making a 'searching and fearless' one of these.", a: "What is a moral inventory?" },
                    500: { q: "In Step 5, members admit to their Higher Power, themselves, and ______ 'the exact nature of our wrongs.'", a: "What is another human being?" }
                },
                "Coping Skills": {
                    100: { q: "This involves writing down thoughts and feelings to understand them more clearly.", a: "What is journaling?" },
                    200: { q: "These are limits and rules we set for ourselves within relationships.", a: "What are healthy boundaries?" },
                    300: { q: "Talking with a trusted friend, family member, or support group is this type of coping skill.", a: "What is social support (or 'reaching out')?" },
                    400: { q: "Physical activity is a well-known coping skill for managing this common feeling.", a: "What is stress (or anxiety/depression)?" },
                    500: { q: "This skill involves focusing on your five senses to help ground you in the present moment during high stress or a craving.", a: "What is grounding?" }
                }
            };

            // ---------------------------------
            // --- 2. GLOBAL ELEMENTS ---
            // ---------------------------------
            // NEW: Intro elements
            const introOverlay = document.getElementById('intro-overlay');
            const startGameBtn = document.getElementById('start-game-btn');
            const gameContainer = document.getElementById('game-container');

            const board = document.getElementById('jeopardy-board');
            const modal = document.getElementById('question-modal');
            const modalCategory = document.getElementById('modal-category');
            const modalPoints = document.getElementById('modal-points');
            const modalQuestion = document.getElementById('modal-question-text');
            const modalAnswer = document.getElementById('modal-answer-text');
            const modalNotification = document.getElementById('modal-notification'); 
            const scoringButtons = document.getElementById('scoring-buttons');
            const correctBtn = document.getElementById('correct-btn');
            const incorrectBtn = document.getElementById('incorrect-btn');
            const resetBtn = document.getElementById('reset-game');
            const nextBtn = document.getElementById('next-btn'); 

            // ---------------------------------
            // --- 3. TEAM ELEMENTS ---
            // ---------------------------------
            const team1Board = document.getElementById('team-1-board');
            const team2Board = document.getElementById('team-2-board');
            // UPDATED: These are now input elements
            const team1ScoreDisplay = document.getElementById('team-1-score');
            const team2ScoreDisplay = document.getElementById('team-2-score');
            const team1ColorPicker = document.getElementById('team-1-color');
            const team2ColorPicker = document.getElementById('team-2-color');
            const team1NameInput = document.getElementById('team-1-name');
            const team2NameInput = document.getElementById('team-2-name');

            // ---------------------------------
            // --- 4. DAILY DOUBLE ELEMENTS ---
            // ---------------------------------
            const ddModal = document.getElementById('daily-double-modal');
            const ddWagerInput = document.getElementById('dd-wager-input');
            const ddWagerLabel = document.getElementById('dd-wager-label');
            const submitWagerBtn = document.getElementById('submit-wager-btn');

            // ---------------------------------
            // --- 5. TIMER ELEMENTS ---
            // ---------------------------------
            const timerContainer = document.getElementById('timer-container');
            const timerDisplay = document.getElementById('timer-display');
            const timerToggleBtn = document.getElementById('timer-toggle-btn');
            // Using inline SVG for icons
            const playIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>`;
            const pauseIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"/></svg>`;

            // ---------------------------------
            // --- 6. NEW MODAL ELEMENTS ---
            // ---------------------------------
            const winnerModal = document.getElementById('winner-modal');
            const winnerNameDisplay = document.getElementById('winner-name');
            const closeWinnerModalBtn = document.getElementById('close-winner-modal-btn');
            const confettiContainer = document.getElementById('confetti-container');

            const changeTeamModal = document.getElementById('change-team-modal');
            const nextTeamNameDisplay = document.getElementById('next-team-name');
            const confirmChangeTeamBtn = document.getElementById('confirm-change-team-btn');

            // ---------------------------------
            // --- 7. GAME STATE VARIABLES ---
            // ---------------------------------
            let team1Score = 0;
            let team2Score = 0;
            let activeTeam = 1; // 1 or 2
            let currentPoints = 0;
            let currentWager = 0;
            let currentDailyDouble = null;
            let timerInterval = null;
            let timerSeconds = 37; // Timer set to 37
            let isTimerRunning = false;
            let attemptState = 'initial'; // 'initial' or 'steal' or 'dailyDouble'
            let consecutiveCorrect1 = 0; // NEW: Track consecutive correct answers
            let consecutiveCorrect2 = 0; // NEW: Track consecutive correct answers
            let totalQuestions = 0; // NEW: Total questions for game end check
            let answeredCount = 0; // NEW: Count answered questions

            // ---------------------------------------------------
            // --- 8. WEB AUDIO API (SOUNDS) ---
            // ---------------------------------------------------
            let audioContext;
            let timerOscillator; 
            let tickTock = 0; 

            // 8a. Initialize Audio
            function initializeAudio() {
                if (!audioContext) {
                    try {
                        const AudioContext = window.AudioContext || window.webkitAudioContext;
                        audioContext = new AudioContext();
                        console.log("AudioContext initialized.");
                    } catch (e) {
                        console.error("Web Audio API is not supported in this browser.", e);
                    }
                }
                // Resume context on user interaction for mobile/autoplay policies
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }

            // NEW: Generative Intro Song
            function playIntroSong() {
                if (!audioContext) initializeAudio();
                const now = audioContext.currentTime;
                
                // Simple C Major to F Major to G Major Sequence
                const notes = [
                    523.25, 659.25, 783.99, 1046.50, // C Major (C5, E5, G5, C6)
                    698.46, 880.00, 1046.50, 1396.91, // F Major (F5, A5, C6, F6)
                    783.99, 987.77, 1174.66, 1567.98  // G Major (G5, B5, D6, G6)
                ];

                notes.forEach((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.type = 'triangle'; // Soft synth sound
                    osc.frequency.value = freq;
                    
                    // Staggered entrance (arpeggio effect)
                    const startTime = now + (index * 0.15); 
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    // Envelope (Fade in and long fade out)
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(0.1, startTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + 4); // Long ring out

                    osc.start(startTime);
                    osc.stop(startTime + 4);
                });
            }


            function playTimerSound() {
                if (!audioContext) return;
                if (timerOscillator) {
                    timerOscillator.stop();
                }
                timerOscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                timerOscillator.type = 'sine';
                
                if (tickTock % 2 === 0) {
                    timerOscillator.frequency.setValueAtTime(1200, audioContext.currentTime); // High tick
                } else {
                    timerOscillator.frequency.setValueAtTime(800, audioContext.currentTime); // Lower tock
                }
                tickTock++;

                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);

                timerOscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                timerOscillator.start();
                timerOscillator.stop(audioContext.currentTime + 0.05);
            }

            function stopTimerSound() {
                if (timerOscillator) {
                    timerOscillator.stop();
                    timerOscillator = null;
                }
                tickTock = 0; 
            }

            function playDailyDoubleSound() {
                if (!audioContext) return;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine';
                osc.connect(gain);
                gain.connect(audioContext.destination);

                const now = audioContext.currentTime;
                gain.gain.setValueAtTime(0.3, now); 
                
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                
                osc.frequency.setValueAtTime(450, now + 0.15);
                osc.frequency.exponentialRampToValueAtTime(900, now + 0.3);

                osc.start();
                osc.stop(now + 0.4);
            }

            function playTimesUpSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sawtooth';
                osc.connect(gain);
                gain.connect(audioContext.destination);

                // Beat 1
                osc.frequency.setValueAtTime(120, now);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

                // Beat 2
                osc.frequency.setValueAtTime(120, now + 0.15);
                gain.gain.setValueAtTime(0.3, now + 0.15);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.25);

                // Beat 3
                osc.frequency.setValueAtTime(120, now + 0.3);
                gain.gain.setValueAtTime(0.3, now + 0.3);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.4);

                osc.start();
                osc.stop(now + 0.4);
            }

            function playStealSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'triangle'; 
                osc.connect(gain);
                gain.connect(audioContext.destination);

                gain.gain.setValueAtTime(0.2, now);
                osc.frequency.setValueAtTime(900, now);
                osc.frequency.setValueAtTime(1200, now + 0.1);
                
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);

                osc.start();
                osc.stop(now + 0.2);
            }

            function playCorrectSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.type = 'triangle'; 
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                gain.gain.setValueAtTime(0.2, now); 

                // "Ta-da-da-DAHHHHH!"
                // Note 1: C5
                osc.frequency.setValueAtTime(523.25, now);
                // Note 2: E5
                osc.frequency.setValueAtTime(659.25, now + 0.1);
                // Note 3: G5
                osc.frequency.setValueAtTime(783.99, now + 0.2);
                // Note 4: C6 (hold longer)
                osc.frequency.setValueAtTime(1046.50, now + 0.3);

                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.7);
                
                osc.start(now);
                osc.stop(now + 0.7);
            }

            // ---------------------------------
            // --- 9. GAME LOGIC (BOARD) ---
            // ---------------------------------
            function createBoard() {
                board.innerHTML = '';
                team1Score = 0;
                team2Score = 0;
                answeredCount = 0;
                totalQuestions = 0;
                consecutiveCorrect1 = 0;
                consecutiveCorrect2 = 0;
                updateScore(0); // This just updates the display
                setActiveTeam(1);

                const categories = Object.keys(gameData);
                categories.forEach(category => {
                    const cell = document.createElement('div');
                    cell.classList.add('category-cell');
                    cell.textContent = category;
                    board.appendChild(cell);
                });
                const points = [100, 200, 300, 400, 500];
                totalQuestions = categories.length * points.length; // Calculate total questions
                let allCells = [];
                points.forEach(point => {
                    categories.forEach(category => {
                        const cell = document.createElement('div');
                        cell.classList.add('question-cell');
                        cell.textContent = `$${point}`; 
                        cell.dataset.category = category;
                        cell.dataset.pointsKey = point; 
                        cell.dataset.pointsValue = point;
                        cell.addEventListener('click', handleQuestionClick);
                        board.appendChild(cell);
                        allCells.push(cell);
                    });
                });
                allCells.forEach(cell => cell.dataset.dailyDouble = 'false');
                const ddIndex = Math.floor(Math.random() * allCells.length);
                allCells[ddIndex].dataset.dailyDouble = 'true';
            }

            // ------------------------------------------
            // --- 10. GAME LOGIC (TEAMS & SCORING) ---
            // ------------------------------------------
            function setActiveTeam(teamNum) {
                activeTeam = teamNum;
                if (teamNum === 1) {
                    team1Board.classList.add('active');
                    team2Board.classList.remove('active');
                } else {
                    team1Board.classList.remove('active');
                    team2Board.classList.add('active');
                }
            }
            
            // Function to update score (programmatic point change)
            function updateScore(points) {
                let currentScore = (activeTeam === 1) ? team1Score : team2Score;
                let newScore = currentScore + points;

                if (newScore < 0) {
                    newScore = 0; 
                }

                if (activeTeam === 1) {
                    team1Score = newScore;
                    team1ScoreDisplay.value = team1Score; // Update input value
                } else {
                    team2Score = newScore;
                    team2ScoreDisplay.value = team2Score; // Update input value
                }
            }

            // Handles manual input change on score field
            function handleScoreInput(teamNum, inputElement) {
                let newValue = parseInt(inputElement.value) || 0;
                if (newValue < 0) {
                    newValue = 0;
                    inputElement.value = 0;
                }
                
                if (teamNum === 1) {
                    team1Score = newValue;
                } else {
                    team2Score = newValue;
                }
            }

            // Reset consecutive correct answers for a team
            function resetConsecutiveCorrect(teamNum) {
                if (teamNum === 1) {
                    consecutiveCorrect1 = 0;
                } else {
                    consecutiveCorrect2 = 0;
                }
            }
            
            // Check if the game is over
            function checkGameEnd() {
                if (answeredCount >= totalQuestions) {
                    showWinnerModal();
                }
            }

            // Logic to determine next team turn after question is resolved
            function determineNextTurn(wasCorrect) {
                const maxStack = 3;
                let nextTeam = activeTeam;
                
                if (wasCorrect) {
                    if (activeTeam === 1) {
                        consecutiveCorrect1++;
                        consecutiveCorrect2 = 0;
                        if (consecutiveCorrect1 >= maxStack) {
                            nextTeam = 2; // Switch to Team 2
                        }
                    } else {
                        consecutiveCorrect2++;
                        consecutiveCorrect1 = 0;
                        if (consecutiveCorrect2 >= maxStack) {
                            nextTeam = 1; // Switch to Team 1
                        }
                    }
                } else {
                    // Turn always switches on a resolved wrong answer (after initial/steal attempts end)
                    nextTeam = activeTeam === 1 ? 2 : 1;
                }

                if (nextTeam !== activeTeam) {
                    // Turn switch triggered by 3 stack OR final wrong answer resolution
                    setActiveTeam(nextTeam);
                    // Check if the board is complete before showing team change
                    if (answeredCount < totalQuestions) {
                        showChangeTeamModal(nextTeam);
                    }
                } else {
                    // No team switch needed, just close modal and check for game end
                    closeModal();
                }
                
                checkGameEnd();
            }


            // ------------------------------------------
            // --- 11. GAME LOGIC (NOTIFICATIONS & TIMER) ---
            // ------------------------------------------
            function showNotification(message, duration = 0) {
                modalNotification.textContent = message;
                modalNotification.classList.remove('hidden');
                if (duration > 0) {
                    setTimeout(hideNotification, duration);
                }
            }
            function hideNotification() {
                modalNotification.classList.add('hidden');
            }

            function resetTimer() {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerSeconds = 37; 
                timerDisplay.textContent = 37; 
                timerToggleBtn.innerHTML = playIcon;
                stopTimerSound(); 
            }

            function startTimer(duration) {
                if (isTimerRunning) return; 
                
                isTimerRunning = true;
                timerSeconds = duration;
                timerDisplay.textContent = duration;
                timerToggleBtn.innerHTML = pauseIcon;
                
                // Play sound immediately to start the clock
                if (attemptState === 'steal') {
                    playStealSound(); 
                } else {
                    playTimerSound(); 
                }

                timerInterval = setInterval(() => {
                    timerSeconds--;
                    timerDisplay.textContent = timerSeconds;
                    
                    if (timerSeconds > 0) {
                        if (attemptState === 'steal') {
                            playStealSound(); 
                        } else {
                            playTimerSound(); 
                        }
                    }

                    if (timerSeconds <= 0) {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        
                        // Times Up on the Initial/Daily Double Team
                        if (attemptState === 'initial' || attemptState === 'dailyDouble') {
                            handleTimesUp(); 
                        } else { 
                            // Times Up on the Steal Team (failed steal attempt)
                            playTimesUpSound(); 
                            // Steal team doesn't lose points on running out of time, only on incorrect answer.
                            resetConsecutiveCorrect(activeTeam); // No point for the steal, reset stack
                            
                            modalAnswer.style.display = 'block'; 
                            showNotification("Time's Up! The answer was...");
                            
                            scoringButtons.classList.add('hidden');
                            nextBtn.classList.remove('hidden');
                        }
                    }
                }, 1000);
            }

            function handleTimerToggle() {
                if (isTimerRunning) {
                    resetTimer();
                } else {
                    startTimer(timerSeconds); 
                }
            }

            // --- handleTimesUp (Initial attempt) ---
            function handleTimesUp() {
                playTimesUpSound(); 
                resetTimer();
                
                const otherTeamNum = activeTeam === 1 ? 2 : 1;
                const otherTeamName = (otherTeamNum === 1 ? team1NameInput.value : team2NameInput.value);
                
                // On initial time-up, no score is deducted yet, it just moves to the steal phase.
                showNotification(`Time's Up! ${otherTeamName}, you have 5 seconds to steal!`);
                
                // We switch the active team here to reflect who has the control.
                setActiveTeam(otherTeamNum);
                attemptState = 'steal';
                
                modalAnswer.style.display = 'none'; 
                scoringButtons.classList.remove('hidden'); 
                
                startTimer(5); // Steal timer is 5 seconds
            }

            // ---------------------------------
            // --- 12. EVENT HANDLERS (CLICKS) ---
            // ---------------------------------
            // NEW: Start Game Button Listener
            startGameBtn.addEventListener('click', () => {
                initializeAudio();
                playIntroSong(); // Play the generative song
                
                // Hide Intro, Show Game
                introOverlay.style.opacity = '0';
                gameContainer.style.opacity = '1';
                setTimeout(() => {
                    introOverlay.style.display = 'none';
                }, 1500);
            });


            function handleQuestionClick(e) {
                if (!audioContext) {
                    // If the user clicks a question without going through the intro, initialize audio now.
                    initializeAudio(); 
                }

                const cell = e.target;
                const category = cell.dataset.category;
                
                const pointsKey = parseInt(cell.dataset.pointsKey); 
                const pointsValue = parseInt(cell.dataset.pointsValue);
                
                if (!category || !pointsKey || cell.classList.contains('answered')) return;
                
                const { q, a } = gameData[category][pointsKey];
                
                if (!q || !a) {
                    console.error("Could not find question for:", category, pointsKey);
                    return; 
                }

                cell.classList.add('answered');
                cell.textContent = '';
                currentPoints = pointsValue;
                answeredCount++; // Increment answered questions

                if (cell.dataset.dailyDouble === 'true') {
                    currentDailyDouble = { category, points: pointsValue, q, a };
                    handleDailyDouble();
                } else {
                    showQuestionModal(category, pointsValue, q, a);
                }
            }

            // ---------------------------------
            // --- 13. MODAL & POPUP LOGIC ---
            // ---------------------------------
            function showQuestionModal(category, points, q, a) {
                modalCategory.textContent = category;
                modalPoints.textContent = `$${points}`;
                modalQuestion.textContent = q;
                modalAnswer.textContent = a;
                
                attemptState = 'initial'; 
                hideNotification(); 
                
                modalAnswer.style.display = 'none'; 
                scoringButtons.classList.remove('hidden');
                nextBtn.classList.add('hidden'); 
                
                timerContainer.style.display = 'flex';
                resetTimer();
                startTimer(37); 

                modal.style.display = 'flex';
            }

            function handleDailyDouble() {
                playDailyDoubleSound();

                const currentTeamScore = (activeTeam === 1) ? team1Score : team2Score;
                const maxWager = Math.max(1000, currentTeamScore); 
                ddWagerInput.value = 5;
                ddWagerInput.min = 5;
                ddWagerInput.max = maxWager;
                ddWagerLabel.textContent = `Enter Wager (Max: $${maxWager}):`
                ddModal.style.display = 'flex';
            }

            submitWagerBtn.addEventListener('click', () => {
                const wager = parseInt(ddWagerInput.value);
                const maxWager = parseInt(ddWagerInput.max);
                if (isNaN(wager) || wager < 5 || wager > maxWager) {
                    ddWagerInput.style.border = '2px solid red';
                    return;
                }
                ddWagerInput.style.border = '2px solid #ccc';
                currentWager = wager;
                currentPoints = wager; 
                ddModal.style.display = 'none';
                const { category, q, a } = currentDailyDouble;
                
                showQuestionModal(`DAILY DOUBLE: ${category}`, `Wager: $${wager}`, q, a);
                attemptState = 'dailyDouble';
            });

            function closeModal() {
                modal.style.display = 'none';
                ddModal.style.display = 'none';
                changeTeamModal.style.display = 'none';
                resetTimer(); 
                hideNotification();
            }

            // Winner Modal
            function showWinnerModal() {
                let winnerName = "";
                if (team1Score > team2Score) {
                    winnerName = team1NameInput.value;
                } else if (team2Score > team1Score) {
                    winnerName = team2NameInput.value;
                } else {
                    winnerName = "It's a Tie!";
                }
                winnerNameDisplay.textContent = winnerName;
                winnerModal.style.display = 'flex';
                // Start the confetti effect
                startConfetti();
            }

            // Change Team Modal
            function showChangeTeamModal(nextTeamNum) {
                const nextTeamName = (nextTeamNum === 1 ? team1NameInput.value : team2NameInput.value);
                nextTeamNameDisplay.textContent = nextTeamName;
                modal.style.display = 'none'; // Close the question modal first
                changeTeamModal.style.display = 'flex';
                
                // Reset consecutive count after a switch due to stacking
                if (activeTeam === 1) { // If switch was to 1, reset 2
                    resetConsecutiveCorrect(2);
                } else { // If switch was to 2, reset 1
                    resetConsecutiveCorrect(1);
                }
            }


            // ------------------------------------------
            // --- 14. BUTTON & INPUT LISTENERS ---
            // ------------------------------------------
            
            // --- Modal Button Listeners ---
            correctBtn.addEventListener('click', () => {
                playCorrectSound(); 
                
                let pointsToAdd = 0;
                // Steals get half points on correct answer
                if (attemptState === 'steal') {
                    pointsToAdd = Math.round(currentPoints / 2);
                    showNotification("Steal successful! Turn switches to you.", 1500);
                } else {
                    pointsToAdd = currentPoints;
                    showNotification("Correct!", 1500);
                }
                updateScore(pointsToAdd);

                modalAnswer.style.display = 'block'; 
                resetTimer();
                
                scoringButtons.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                
                // Correct answer was given, now determine the next turn/team
                determineNextTurn(true); 
            });

            incorrectBtn.addEventListener('click', () => {
                playTimesUpSound(); 
                
                let wasFinal = false; // Flag to indicate if this is the end of the question interaction

                if (attemptState === 'dailyDouble') {
                    // Daily Double: Lose full wager, question is over
                    updateScore(-currentPoints);
                    resetConsecutiveCorrect(activeTeam);
                    showNotification("Incorrect! The answer was...", 1500);
                    wasFinal = true;
                    
                } else if (attemptState === 'initial') {
                    // Initial attempt: Lose half points, switch to steal phase
                    const pointsToLose = -Math.round(currentPoints / 2);
                    updateScore(pointsToLose); 
                    resetConsecutiveCorrect(activeTeam);
                    
                    attemptState = 'steal';
                    const otherTeamNum = activeTeam === 1 ? 2 : 1;
                    const otherTeamName = (otherTeamNum === 1 ? team1NameInput.value : team2NameInput.value);
                    
                    // We switch the active team here for the steal attempt
                    setActiveTeam(otherTeamNum);
                    showNotification(`Incorrect! ${otherTeamName}, you have 5 seconds to steal!`);
                    
                    modalAnswer.style.display = 'none'; 
                    resetTimer();
                    startTimer(5); 
                    return; // Return to keep the modal open for the steal attempt
                    
                } else if (attemptState === 'steal') { 
                    // Failed steal: Stealing team loses half points, question is over
                    const pointsToLose = -Math.round(currentPoints / 2);
                    updateScore(pointsToLose);
                    resetConsecutiveCorrect(activeTeam);
                    showNotification("Incorrect steal attempt! The answer was...");
                    wasFinal = true;
                }
                
                if (wasFinal) {
                    modalAnswer.style.display = 'block'; 
                    resetTimer();
                    scoringButtons.classList.add('hidden');
                    nextBtn.classList.remove('hidden');
                    
                    // Incorrect answer (finalized), determine next turn/team
                    determineNextTurn(false);
                }
            });

            // Next Button uses determineNextTurn() logic
            nextBtn.addEventListener('click', () => {
                closeModal();
            });
            
            // Listeners for direct score input change
            team1ScoreDisplay.addEventListener('blur', (e) => handleScoreInput(1, e.target));
            team2ScoreDisplay.addEventListener('blur', (e) => handleScoreInput(2, e.target));
            // Allows using Enter key to finalize score edit
            team1ScoreDisplay.addEventListener('keydown', (e) => { if (e.key === 'Enter') e.target.blur(); });
            team2ScoreDisplay.addEventListener('keydown', (e) => { if (e.key === 'Enter') e.target.blur(); });


            // Change Team Modal confirmation
            confirmChangeTeamBtn.addEventListener('click', closeModal);
            
            // Close Winner Modal (and reset game)
            closeWinnerModalBtn.addEventListener('click', () => {
                winnerModal.style.display = 'none';
                confettiContainer.innerHTML = ''; // Clear confetti
                createBoard();
                // After reset, show intro screen again
                introOverlay.style.display = 'flex';
                introOverlay.style.opacity = '1';
                gameContainer.style.opacity = '0';
            });


            // Close modal if clicking outside the content (only for DD)
            window.addEventListener('click', (e) => {
                if (e.target === ddModal) {
                    // Only close DD if clicking outside
                    ddModal.style.display = 'none';
                }
            });

            // --- Team Customization Listeners ---
            team1Board.addEventListener('click', () => setActiveTeam(1));
            team2Board.addEventListener('click', () => setActiveTeam(2)); 
            // Prevent clicking the score input from changing the active team
            team1ScoreDisplay.addEventListener('click', (e) => e.stopPropagation());
            team2ScoreDisplay.addEventListener('click', (e) => e.stopPropagation());
            team1NameInput.addEventListener('click', (e) => e.stopPropagation());
            team2NameInput.addEventListener('click', (e) => e.stopPropagation());
            team1ColorPicker.addEventListener('click', (e) => e.stopPropagation());
            team2ColorPicker.addEventListener('click', (e) => e.stopPropagation());
            
            team1ColorPicker.addEventListener('input', (e) => {
                team1Board.style.setProperty('--team-color', e.target.value);
            });
            team2ColorPicker.addEventListener('input', (e) => {
                team2Board.style.setProperty('--team-color', e.target.value);
            });

            // Reset game
            resetBtn.addEventListener('click', () => {
                 if (confirm("Are you sure you want to reset the game? This will return to the intro screen.")) {
                    resetTimer(); 
                    closeModal();
                    createBoard();
                    // Go back to the intro screen
                    introOverlay.style.display = 'flex';
                    introOverlay.style.opacity = '1';
                    gameContainer.style.opacity = '0';
                 }
            });

            // Timer Toggle
            timerToggleBtn.addEventListener('click', handleTimerToggle);
            
            // ---------------------------------
            // --- 15. CONFETTI EFFECT ---
            // ---------------------------------
            const confettiColors = ['#ffcc00', '#06226e', '#ff9900', '#ffffff', '#ef4444'];
            
            function createConfetto() {
                const confetto = document.createElement('div');
                confetto.style.width = `${Math.random() * 8 + 5}px`;
                confetto.style.height = `${Math.random() * 12 + 8}px`;
                confetto.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                confetto.style.position = 'absolute';
                confetto.style.left = `${Math.random() * 100}vw`;
                confetto.style.top = `${-20 - Math.random() * 20}px`;
                confetto.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetto.style.borderRadius = '2px';
                confetto.style.opacity = '0.9';

                // Random animation duration and delay
                const duration = Math.random() * 3 + 4; // 4 to 7 seconds
                const delay = Math.random() * 2; // 0 to 2 seconds

                confetto.animate([
                    { transform: `translateY(0) rotate(${Math.random() * 720}deg) translateX(0)`, opacity: 0.9 },
                    { transform: `translateY(${window.innerHeight * 1.5}px) rotate(${Math.random() * 720 + 360}deg) translateX(${Math.random() * 300 - 150}px)`, opacity: 0.1 }
                ], {
                    duration: duration * 1000,
                    delay: delay * 1000,
                    iterations: 1,
                    fill: 'forwards',
                    easing: 'cubic-bezier(0.5, 0.1, 0.5, 1)'
                }).onfinish = () => confetto.remove();

                confettiContainer.appendChild(confetto);
            }

            function startConfetti() {
                // Clear any old confetti
                confettiContainer.innerHTML = '';
                const numConfetti = 150;
                for (let i = 0; i < numConfetti; i++) {
                    setTimeout(createConfetto, i * 20);
                }
            }


            // ---------------------------------
            // --- 16. INITIALIZE GAME ---
            // ---------------------------------
            createBoard();
            resetTimer(); 
        });
    </script>
</body>
</html>