<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise Detox Presents: Detox Jeopardy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        html, body {
            font-family: 'Inter', sans-serif;
            background-color: #060a2b; /* Deep blue */
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            margin: 0;
        }

        /* --- INTRO ANIMATION STYLES --- */
        #intro-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, #020411, #1a0b16);
            transition: opacity 1.5s ease-in-out;
        }
        
        .animate-sky {
            animation: sky-change 4s ease-out forwards;
        }

        .sun-graphic {
            width: 150px;
            height: 150px;
            background: linear-gradient(to bottom, #fbbf24, #f59e0b);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(251, 191, 36, 0.6);
            position: relative;
            z-index: 10;
            animation: sunrise 4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .ocean {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(to top, #06226e, #1e3a8a);
            z-index: 20;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }

        .intro-content {
            position: relative;
            z-index: 30;
            text-align: center;
            margin-top: -80px; /* Overlap sun slightly */
            opacity: 0;
            animation: fade-in-text 2s ease-out forwards;
            animation-delay: 3s; /* Wait for sun */
        }

        @keyframes sunrise {
            0% { transform: translateY(200%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes sky-change {
            0% { background: linear-gradient(to bottom, #020411, #000000); }
            100% { background: linear-gradient(to bottom, #1e1b4b, #4c1d95); }
        }
        @keyframes fade-in-text {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* --- GAME BOARD STYLES --- */
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            opacity: 0; /* Hidden until intro done */
            transition: opacity 1s ease-in;
        }

        .jeopardy-board {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 4px;
            flex-grow: 1;
            min-height: 0;
            padding: 4px;
        }

        .category-cell {
            background-color: #06226e;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: clamp(4px, 1.2vh, 8px) 4px;
            font-size: clamp(0.65rem, 2.4vw, 0.875rem);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
            text-shadow: 1px 1px 0 #000;
        }

        .question-cell {
            background-color: #06226e;
            color: #ffcc00;
            font-size: clamp(1rem, 4vw, 2rem);
            font-weight: 900;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
            text-shadow: 2px 2px 0 #000;
        }

        .question-cell:hover {
            transform: scale(1.05);
            background-color: #0e3aa6;
            z-index: 10;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }

        .question-cell.answered {
            background-color: #373b5a;
            color: transparent; /* Hide text */
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: #06226e;
            border: 4px solid white;
            color: white;
            margin: auto;
            padding: clamp(12px, 3vw, 30px);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .modal-question {
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            line-height: 1.4;
        }

        .modal-answer {
            display: none;
            font-size: clamp(1rem, 3.5vw, 1.5rem);
            font-weight: 600;
            color: #fbbf24; /* Yellow */
            margin: 16px 0;
            font-style: italic;
        }

        /* SCOREBOARD */
        .team-scoreboard {
            background-color: #ffffff;
            padding: 8px;
            border-radius: 8px;
            border: 4px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .team-scoreboard.active {
            border-color: var(--team-color, #3b82f6);
            box-shadow: 0 0 20px var(--team-color, #3b82f6);
            transform: scale(1.02);
        }
        .team-score {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 900;
            color: #06226e;
        }

    </style>
</head>
<body class="p-2 md:p-4">

    <div id="intro-overlay" class="animate-sky">
        <div class="sun-graphic"></div>
        <div class="ocean"></div>
        
        <div class="intro-content">
            <h1 class="text-5xl md:text-7xl font-extrabold text-white tracking-wide drop-shadow-lg mb-2">
                <span class="text-yellow-400">SUNRISE</span> DETOX
            </h1>
            <p class="text-xl text-blue-200 tracking-[0.5em] uppercase font-semibold mb-8">Recovery Trivia</p>
            
            <button id="start-game-btn" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-blue-900 transition-all duration-200 bg-yellow-400 font-pj rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 hover:bg-yellow-300 hover:scale-110 shadow-[0_0_20px_rgba(253,224,71,0.5)]">
                START GAME
            </button>
            <div class="mt-4 text-blue-300 text-xs opacity-70">Click Start to Enable Audio</div>
        </div>
    </div>

    <div id="game-container" class="container mx-auto max-w-7xl">
        <div class="relative flex justify-between items-center mb-3 px-2">
             <div class="text-white font-bold opacity-50 text-sm">Sunrise Detox</div>
             <h1 class="text-xl md:text-3xl font-extrabold text-center text-white tracking-wider shadow-black drop-shadow-md">DETOX JEOPARDY</h1>
             <button id="reset-game" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-xs uppercase tracking-wide">
                Reset
            </button>
        </div>
       
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div id="team-1-board" class="team-scoreboard active" style="--team-color: #3b82f6;">
                <div class="flex items-center gap-2 mb-1">
                    <input type="color" id="team-1-color" class="w-6 h-6 rounded-full border-none cursor-pointer p-0" value="#3b82f6">
                    <input type="text" id="team-1-name" class="font-bold text-gray-800 border-b-2 border-transparent focus:border-blue-500 outline-none w-full bg-transparent" value="Team 1">
                </div>
                <div class="flex justify-between items-baseline">
                    <span class="text-xs font-bold text-gray-400 uppercase">Score</span>
                    <span id="team-1-score" class="team-score">0</span>
                </div>
            </div>

            <div id="team-2-board" class="team-scoreboard" style="--team-color: #ef4444;">
                <div class="flex items-center gap-2 mb-1">
                    <input type="color" id="team-2-color" class="w-6 h-6 rounded-full border-none cursor-pointer p-0" value="#ef4444">
                    <input type="text" id="team-2-name" class="font-bold text-gray-800 border-b-2 border-transparent focus:border-red-500 outline-none w-full bg-transparent" value="Team 2">
                </div>
                <div class="flex justify-between items-baseline">
                    <span class="text-xs font-bold text-gray-400 uppercase">Score</span>
                    <span id="team-2-score" class="team-score">0</span>
                </div>
            </div>
        </div>

        <div id="jeopardy-board" class="jeopardy-board bg-black rounded-lg border-4 border-black shadow-2xl">
            </div>
    </div>

    <div id="question-modal" class="modal">
        <div class="modal-content relative">
            <div class="flex justify-between items-center border-b border-blue-800 pb-4 mb-4">
                <span id="modal-category" class="text-xl font-bold text-blue-200 uppercase tracking-widest">Category</span>
                <span id="modal-points" class="text-3xl font-black text-yellow-400 drop-shadow-md">$000</span>
            </div>
            
            <div id="modal-notification" class="hidden text-center text-xl font-bold text-red-400 my-2 animate-pulse"></div>

            <div class="flex-grow flex flex-col justify-center">
                <div id="modal-question-text" class="modal-question">Question text...</div>
                <div id="modal-answer-text" class="modal-answer">Answer text...</div>
            </div>

            <div class="mt-6">
                <div id="timer-container" class="flex justify-center items-center gap-4 mb-6">
                    <div id="timer-display" class="text-5xl font-black text-white font-mono">37</div>
                    <button id="timer-toggle-btn" class="w-12 h-12 bg-white text-blue-900 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors">
                        </button>
                </div>

                <div id="button-container" class="flex flex-col gap-3">
                    <div id="scoring-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button id="correct-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-transform hover:scale-105 text-xl shadow-lg border-b-4 border-green-700">
                            I Got It Right!
                        </button>
                        <button id="incorrect-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-xl transition-transform hover:scale-105 text-xl shadow-lg border-b-4 border-red-700">
                            I Got It Wrong
                        </button>
                    </div>
                    <button id="next-btn" class="hidden w-full bg-blue-500 hover:bg-blue-400 text-white font-bold py-4 px-6 rounded-xl transition-transform hover:scale-105 text-xl shadow-lg border-b-4 border-blue-700 uppercase tracking-widest">
                        Return to Board
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="daily-double-modal" class="modal">
        <div class="modal-content" style="background: #000; border: 6px solid #fbbf24; min-height: 300px;">
            <h2 class="text-4xl md:text-6xl font-black text-center text-yellow-400 mb-8 uppercase tracking-tighter animate-bounce">DAILY DOUBLE</h2>
            <div class="text-center mb-6">
                <label for="dd-wager-input" class="block text-white text-2xl font-bold mb-4" id="dd-wager-label">Enter Wager:</label>
                <input type="number" id="dd-wager-input" class="text-4xl font-bold text-center w-full max-w-xs p-4 rounded-lg text-black border-4 border-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300" min="5">
            </div>
            <button id="submit-wager-btn" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-black py-4 rounded-lg text-2xl uppercase tracking-wide shadow-lg">
                Submit Wager
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ---------------------------------
            // --- 1. GAME DATA (Updated) ---
            // ---------------------------------
            const gameData = {
                "Famous Faces": {
                    100: { q: "This 'Iron Man' actor has been sober since 2003 and is one of Hollywood's biggest recovery success stories.", a: "Who is Robert Downey Jr.?" },
                    200: { q: "This rapper, known for 'Not Afraid' and 'Lose Yourself', celebrated 16 years of sobriety in 2024.", a: "Who is Eminem?" },
                    300: { q: "This 'Rocketman' singer founded an AIDS Foundation and has been sober for over 30 years.", a: "Who is Elton John?" },
                    400: { q: "Famous for the song 'Chandelier', this singer often hides her face but is open about her sobriety.", a: "Who is Sia?" },
                    500: { q: "This 'Halloween' actress and daughter of Tony Curtis calls her recovery the 'greatest accomplishment' of her life.", a: "Who is Jamie Lee Curtis?" }
                },
                "Slogans & Wisdom": {
                    100: { q: "This popular three-word phrase reminds us not to worry about the far future, but to handle life in 24-hour chunks.", a: "What is 'One Day at a Time'?" },
                    200: { q: "This slogan suggests that we don't need to be perfect in our recovery, we just need to keep moving forward.", a: "What is 'Progress not Perfection'?" },
                    300: { q: "This acronym (H.A.L.T.) reminds us to check if we are Hungry, Angry, Lonely, or ______.", a: "What is Tired?" },
                    400: { q: "This gentle reminder tells us not to rush our recovery or force solutions before they are ready.", a: "What is 'Easy Does It'?" },
                    500: { q: "This phrase invites us to release our desire to control outcomes and trust in a power greater than ourselves.", a: "What is 'Let Go and Let God'?" }
                },
                "Recovery in Movies": {
                    100: { q: "In this 2000 film, Sandra Bullock plays a newspaper columnist who finds humor and healing during 28 days in rehab.", a: "What is '28 Days'?" },
                    200: { q: "James Woods won an Emmy for playing this historical figure and co-founder of Alcoholics Anonymous in a 1989 movie.", a: "Who is Bill W.?" },
                    300: { q: "This 2019 biopic tells the story of Elton John's rise to fame and his eventual journey into sobriety.", a: "What is 'Rocketman'?" },
                    400: { q: "Meg Ryan plays a mother seeking treatment for alcoholism in this sensitive drama about how recovery affects the family.", a: "What is 'When a Man Loves a Woman'?" },
                    500: { q: "This groundbreaking documentary focuses not on addiction, but on the millions of people living openly in long-term recovery.", a: "What is 'The Anonymous People'?" }
                },
                "Recovery Tools": {
                    100: { q: "This popular tool involves writing down your daily thoughts and feelings to process emotions safely.", a: "What is journaling?" },
                    200: { q: "This practice involves sitting quietly and focusing on your breath to lower stress and stay in the present moment.", a: "What is meditation (or mindfulness)?" },
                    300: { q: "To protect your peace and sobriety, you often need to set these healthy limits with friends or family.", a: "What are boundaries?" },
                    400: { q: "This daily habit involves listing 3 to 5 things you are thankful for to help shift your mindset to the positive.", a: "What is a gratitude list?" },
                    500: { q: "This tool involves getting out of your own head by helping others or doing volunteer work in the community.", a: "What is service (or being of service)?" }
                },
                "Brain & Body": {
                    100: { q: "This organ is the primary filter for toxins in the body and has an amazing ability to regenerate after you stop drinking.", a: "What is the Liver?" },
                    200: { q: "This 'reward' chemical is depleted during active addiction but slowly regenerates, allowing us to feel natural joy again.", a: "What is Dopamine?" },
                    300: { q: "Often neglected, drinking plenty of this is one of the simplest ways to help your body heal and think clearly.", a: "What is Water (or Hydration)?" },
                    400: { q: "The brain has the ability to rewire itself and form new, healthy pathways. This scientific concept is called ______.", a: "What is Neuroplasticity?" },
                    500: { q: "Symptoms like fog, anxiety, or sleep issues that last for months after quitting are known as P.A.W.S., which stands for this.", a: "What is Post-Acute Withdrawal Syndrome?" }
                }
            };

            // ---------------------------------
            // --- 2. ELEMENTS ---
            // ---------------------------------
            // Intro
            const introOverlay = document.getElementById('intro-overlay');
            const startGameBtn = document.getElementById('start-game-btn');
            const gameContainer = document.getElementById('game-container');

            // Board
            const board = document.getElementById('jeopardy-board');
            const modal = document.getElementById('question-modal');
            const modalCategory = document.getElementById('modal-category');
            const modalPoints = document.getElementById('modal-points');
            const modalQuestion = document.getElementById('modal-question-text');
            const modalAnswer = document.getElementById('modal-answer-text');
            const modalNotification = document.getElementById('modal-notification'); 
            const scoringButtons = document.getElementById('scoring-buttons');
            const correctBtn = document.getElementById('correct-btn');
            const incorrectBtn = document.getElementById('incorrect-btn');
            const resetBtn = document.getElementById('reset-game');
            const nextBtn = document.getElementById('next-btn');

            // Teams
            const team1Board = document.getElementById('team-1-board');
            const team2Board = document.getElementById('team-2-board');
            const team1ScoreDisplay = document.getElementById('team-1-score');
            const team2ScoreDisplay = document.getElementById('team-2-score');
            const team1ColorPicker = document.getElementById('team-1-color');
            const team2ColorPicker = document.getElementById('team-2-color');
            const team1NameInput = document.getElementById('team-1-name');
            const team2NameInput = document.getElementById('team-2-name');

            // Daily Double
            const ddModal = document.getElementById('daily-double-modal');
            const ddWagerInput = document.getElementById('dd-wager-input');
            const ddWagerLabel = document.getElementById('dd-wager-label');
            const submitWagerBtn = document.getElementById('submit-wager-btn');

            // Timer
            const timerContainer = document.getElementById('timer-container');
            const timerDisplay = document.getElementById('timer-display');
            const timerToggleBtn = document.getElementById('timer-toggle-btn');
            const playIcon = `<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
            const pauseIcon = `<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;

            // State
            let team1Score = 0;
            let team2Score = 0;
            let activeTeam = 1;
            let currentPoints = 0;
            let currentWager = 0;
            let currentDailyDouble = null;
            let timerInterval = null;
            let timerSeconds = 37;
            let isTimerRunning = false;
            let attemptState = 'initial'; // 'initial', 'steal', 'dailyDouble'

            // ---------------------------------
            // --- 3. AUDIO SYSTEM (WEB AUDIO API) ---
            // ---------------------------------
            let audioContext = null;
            let timerOscillator = null;
            let tickTock = 0;

            function initializeAudio() {
                if (!audioContext) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioContext = new AudioContext();
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }

            // GENERATIVE INTRO SONG (Uplifting Arpeggio)
            function playIntroSong() {
                if (!audioContext) initializeAudio();
                const now = audioContext.currentTime;
                
                // Simple C Major to F Major to G Major Sequence
                const notes = [
                    523.25, 659.25, 783.99, 1046.50, // C Major (C5, E5, G5, C6)
                    698.46, 880.00, 1046.50, 1396.91, // F Major (F5, A5, C6, F6)
                    783.99, 987.77, 1174.66, 1567.98  // G Major (G5, B5, D6, G6)
                ];

                notes.forEach((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.type = 'triangle'; // Soft synth sound
                    osc.frequency.value = freq;
                    
                    // Staggered entrance (arpeggio effect)
                    const startTime = now + (index * 0.15); 
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    // Envelope (Fade in and long fade out)
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(0.1, startTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + 4); // Long ring out

                    osc.start(startTime);
                    osc.stop(startTime + 4);
                });
            }

            function playTimerSound() {
                if (!audioContext) return;
                if (timerOscillator) timerOscillator.stop();
                
                timerOscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                timerOscillator.type = 'sine';
                // High tick / Low tock
                if (tickTock % 2 === 0) {
                    timerOscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                } else {
                    timerOscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                }
                tickTock++;
                
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);

                timerOscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                timerOscillator.start();
                timerOscillator.stop(audioContext.currentTime + 0.05);
            }

            function stopTimerSound() {
                if (timerOscillator) {
                    timerOscillator.stop();
                    timerOscillator = null;
                }
                tickTock = 0;
            }

            function playCorrectSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'triangle'; // Fanfare style
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                // Ta-da-da-DAAAA! (Major chord)
                gain.gain.setValueAtTime(0.2, now);
                
                osc.frequency.setValueAtTime(523.25, now); // C5
                osc.frequency.setValueAtTime(659.25, now + 0.1); // E5
                osc.frequency.setValueAtTime(783.99, now + 0.2); // G5
                osc.frequency.setValueAtTime(1046.50, now + 0.3); // C6
                
                gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
                osc.start(now);
                osc.stop(now + 1.5);
            }

            function playTimesUpSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sawtooth'; // Buzzer style
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.3);
                
                osc.start(now);
                osc.stop(now + 0.3);
            }

            function playDailyDoubleSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'square'; // Laser/Sci-fi style
                osc.connect(gain);
                gain.connect(audioContext.destination);

                gain.gain.setValueAtTime(0.1, now);
                
                // Rapid rising pitch
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.4);
                
                osc.start(now);
                osc.stop(now + 0.4);
            }

            function playStealSound() {
                if (!audioContext) return;
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine'; 
                osc.connect(gain);
                gain.connect(audioContext.destination);

                gain.gain.setValueAtTime(0.2, now);
                osc.frequency.setValueAtTime(880, now);
                osc.frequency.setValueAtTime(1100, now + 0.1);
                
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }


            // ---------------------------------
            // --- 4. GAME LOGIC ---
            // ---------------------------------
            
            // --- INTRO HANDLER ---
            startGameBtn.addEventListener('click', () => {
                initializeAudio();
                playIntroSong(); // Play the generative song
                
                // Hide Intro, Show Game
                introOverlay.style.opacity = '0';
                gameContainer.style.opacity = '1';
                setTimeout(() => {
                    introOverlay.style.display = 'none';
                }, 1500);
            });


            function createBoard() {
                board.innerHTML = '';
                team1Score = 0;
                team2Score = 0;
                updateScore(0);
                setActiveTeam(1);

                const categories = Object.keys(gameData);
                
                // Header Row
                categories.forEach(category => {
                    const cell = document.createElement('div');
                    cell.classList.add('category-cell');
                    cell.textContent = category;
                    board.appendChild(cell);
                });

                // Question Rows
                const points = [100, 200, 300, 400, 500];
                let allCells = [];
                
                points.forEach(point => {
                    categories.forEach(category => {
                        const cell = document.createElement('div');
                        cell.classList.add('question-cell');
                        cell.textContent = `$${point}`;
                        cell.dataset.category = category;
                        cell.dataset.pointsKey = point; 
                        cell.dataset.pointsValue = point;
                        cell.addEventListener('click', handleQuestionClick);
                        board.appendChild(cell);
                        allCells.push(cell);
                    });
                });

                // Daily Double Logic (Randomly assign one)
                allCells.forEach(cell => cell.dataset.dailyDouble = 'false');
                if (allCells.length > 0) {
                    const ddIndex = Math.floor(Math.random() * allCells.length);
                    allCells[ddIndex].dataset.dailyDouble = 'true';
                }
            }

            function setActiveTeam(teamNum) {
                activeTeam = teamNum;
                if (teamNum === 1) {
                    team1Board.classList.add('active');
                    team2Board.classList.remove('active');
                } else {
                    team1Board.classList.remove('active');
                    team2Board.classList.add('active');
                }
            }

            function updateScore(points) {
                let currentScore = (activeTeam === 1) ? team1Score : team2Score;
                let newScore = currentScore + points;
                if (newScore < 0) newScore = 0; // No negative scores

                if (activeTeam === 1) {
                    team1Score = newScore;
                    team1ScoreDisplay.textContent = team1Score;
                } else {
                    team2Score = newScore;
                    team2ScoreDisplay.textContent = team2Score;
                }
            }
            
            function showNotification(message, duration = 0) {
                modalNotification.textContent = message;
                modalNotification.classList.remove('hidden');
                if (duration > 0) {
                    setTimeout(() => modalNotification.classList.add('hidden'), duration);
                }
            }

            // --- TIMER ---
            function resetTimer() {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerSeconds = 37;
                timerDisplay.textContent = 37;
                timerToggleBtn.innerHTML = playIcon;
                stopTimerSound(); 
            }

            function startTimer(duration) {
                if (isTimerRunning) return;
                isTimerRunning = true;
                timerSeconds = duration;
                timerDisplay.textContent = duration;
                timerToggleBtn.innerHTML = pauseIcon;
                
                playTimerSound();
                timerInterval = setInterval(() => {
                    timerSeconds--;
                    timerDisplay.textContent = timerSeconds;
                    
                    if (timerSeconds > 0) {
                        if (attemptState === 'steal') playStealSound();
                        else playTimerSound(); 
                    }

                    if (timerSeconds <= 0) {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        
                        if (attemptState === 'initial') {
                            handleTimesUp(); 
                        } else { 
                            // Steal failed
                            playTimesUpSound(); 
                            modalAnswer.style.display = 'block'; 
                            showNotification("Time's Up! The answer was...");
                            scoringButtons.classList.add('hidden');
                            nextBtn.classList.remove('hidden');
                        }
                    }
                }, 1000);
            }

            function handleTimerToggle() {
                if (isTimerRunning) resetTimer();
                else startTimer(timerSeconds);
            }

            function handleTimesUp() {
                playTimesUpSound();
                resetTimer();
                const otherTeamNum = activeTeam === 1 ? 2 : 1;
                const otherTeamName = (otherTeamNum === 1 ? team1NameInput.value : team2NameInput.value);
                showNotification(`Time's Up! ${otherTeamName}, you have 5 seconds to steal!`);
                
                attemptState = 'steal';
                setActiveTeam(otherTeamNum);
                modalAnswer.style.display = 'none'; 
                scoringButtons.classList.remove('hidden'); 
                startTimer(5);
            }

            // --- CLICKS ---
            function handleQuestionClick(e) {
                initializeAudio(); // Ensure audio is ready
                const cell = e.target;
                const category = cell.dataset.category;
                const pointsKey = parseInt(cell.dataset.pointsKey); 
                const pointsValue = parseInt(cell.dataset.pointsValue);
                
                if (!category || !pointsKey || cell.classList.contains('answered')) return;
                
                const { q, a } = gameData[category][pointsKey];
                
                cell.classList.add('answered');
                cell.textContent = '';
                currentPoints = pointsValue;

                if (cell.dataset.dailyDouble === 'true') {
                    currentDailyDouble = { category, points: pointsValue, q, a };
                    handleDailyDouble();
                } else {
                    showQuestionModal(category, pointsValue, q, a);
                }
            }

            function showQuestionModal(category, points, q, a) {
                modalCategory.textContent = category;
                modalPoints.textContent = `$${points}`;
                modalQuestion.textContent = q;
                modalAnswer.textContent = a;
                
                attemptState = 'initial'; 
                modalNotification.classList.add('hidden');
                modalAnswer.style.display = 'none'; 
                scoringButtons.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                
                resetTimer();
                startTimer(37);
                modal.style.display = 'flex';
            }

            function handleDailyDouble() {
                playDailyDoubleSound();
                const currentTeamScore = (activeTeam === 1) ? team1Score : team2Score;
                const maxWager = Math.max(1000, currentTeamScore); 
                ddWagerInput.value = 5;
                ddWagerInput.min = 5;
                ddWagerInput.max = maxWager;
                ddWagerLabel.textContent = `Enter Wager (Max: $${maxWager}):`
                ddModal.style.display = 'flex';
            }

            submitWagerBtn.addEventListener('click', () => {
                let wager = parseInt(ddWagerInput.value);
                const maxWager = parseInt(ddWagerInput.max);
                if (isNaN(wager) || wager < 5) wager = 5;
                if (wager > maxWager) wager = maxWager;
                
                currentWager = wager;
                currentPoints = wager; 
                ddModal.style.display = 'none';
                
                const { category, q, a } = currentDailyDouble;
                showQuestionModal(`DAILY DOUBLE: ${category}`, `Wager: $${wager}`, q, a);
                attemptState = 'dailyDouble';
            });

            function closeModal() {
                modal.style.display = 'none';
                ddModal.style.display = 'none';
                resetTimer(); 
                modalNotification.classList.add('hidden');
            }

            // --- SCORING BUTTONS ---
            correctBtn.addEventListener('click', () => {
                playCorrectSound(); 
                let pointsToAdd = 0;
                
                if (attemptState === 'steal') {
                    pointsToAdd = Math.round(currentPoints / 2);
                    showNotification("Steal successful!", 1500);
                } else {
                    pointsToAdd = currentPoints;
                    showNotification("Correct!", 1500);
                }
                updateScore(pointsToAdd);

                modalAnswer.style.display = 'block'; 
                resetTimer();
                scoringButtons.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            });

            incorrectBtn.addEventListener('click', () => {
                playTimesUpSound();
                
                if (attemptState === 'initial' || attemptState === 'dailyDouble') {
                    // Lose points
                    let pointsToLose = 0;
                    if (attemptState === 'dailyDouble') pointsToLose = -currentPoints;
                    else pointsToLose = -Math.round(currentPoints / 2);
                    
                    updateScore(pointsToLose); 

                    if (attemptState === 'dailyDouble') {
                        modalAnswer.style.display = 'block'; 
                        showNotification("Incorrect! The answer was...");
                        resetTimer();
                        scoringButtons.classList.add('hidden');
                        nextBtn.classList.remove('hidden');
                        return;
                    }

                    // Setup Steal
                    attemptState = 'steal';
                    const otherTeamNum = activeTeam === 1 ? 2 : 1;
                    const otherTeamName = (otherTeamNum === 1 ? team1NameInput.value : team2NameInput.value);
                    setActiveTeam(otherTeamNum);
                    showNotification(`Incorrect! ${otherTeamName}, you have 5 seconds to steal!`);
                    
                    modalAnswer.style.display = 'none'; 
                    resetTimer();
                    startTimer(5);
                    
                } else { 
                    // Steal failed
                    modalAnswer.style.display = 'block';
                    showNotification("Incorrect! The answer was...");
                    resetTimer();
                    scoringButtons.classList.add('hidden');
                    nextBtn.classList.remove('hidden');
                }
            });

            nextBtn.addEventListener('click', closeModal);
            resetBtn.addEventListener('click', () => {
                if(confirm("Are you sure you want to reset the game?")) {
                    resetTimer();
                    createBoard();
                }
            });
            timerToggleBtn.addEventListener('click', handleTimerToggle);
            
            // Team Color/Name Events
            team1Board.addEventListener('click', () => setActiveTeam(1));
            team2Board.addEventListener('click', () => setActiveTeam(2)); 
            team1NameInput.addEventListener('click', (e) => e.stopPropagation());
            team2NameInput.addEventListener('click', (e) => e.stopPropagation());
            team1ColorPicker.addEventListener('click', (e) => e.stopPropagation());
            team2ColorPicker.addEventListener('click', (e) => e.stopPropagation());
            team1ColorPicker.addEventListener('input', (e) => team1Board.style.setProperty('--team-color', e.target.value));
            team2ColorPicker.addEventListener('input', (e) => team2Board.style.setProperty('--team-color', e.target.value));

            // Init
            createBoard();
            resetTimer();
        });
    </script>
</body>
</html>